---
title: "Portfolio2"
output: html_document
---
# FitBit Fitness Tracker Data
This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data.(dataset in kaggle)[https://www.kaggle.com/arashnic/fitbit]

#![image]()

## Main Question to answer in this Report :
1. What factors could affect the activity level of the user? 
2. How much active the users using fitbit tracker? 
3. Is there any improvement in the users weight? 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### import needed packages

```{r}
library(readr)
library(ggplot2)
library(plotly)
library(dplyr)
library(tidyr)

```

### read data 

```{r data}
df_fitness <- read.csv(file = '~/Documents/Misk_DSI_data/private/dailyActivity_merged.csv')

```


## Exploring the dataset 
```{r}
head(df_fitness)
```
```{r}
str(df_fitness)
```


```{r}
summary(df_fitness)
```

```{r}
#do we have any duplicate ?
sum(duplicated(df_fitness))

```

```{r}
# do we have null values? 
sum(is.null(df_fitness))
```
#how many users we have in the dataset? 
```{r}
length(unique(df_fitness$Id))
```
# howw many non-zero value in Logged Activities Distance column? 
```{r}
non_zero <- sum(df_fitness$LoggedActivitiesDistance != 0)
sum(df_fitness$LoggedActivitiesDistance == 0)

total <- length(df_fitness$Id)

(non_zero/total)*100
# since it only 3% of the column is available and we have other informative features than LoggedActivitiesDistance I will ignore this column
```




# Q1: what could affect activity levels? is the weekday, month have a influnce on users?

- Changeing the date format in order to extract months and days? 
```{r}

library(dplyr)
df_fitness <- df_fitness %>%
   mutate(ActivityDate=as.Date(ActivityDate, format = "%m/%d/%Y")) 

str(df_fitness)

```
- Extract the month and day and add them to new columns

```{r}
df_fitness <- df_fitness %>%
  mutate(month = format(df_fitness$ActivityDate, "%b"))

df_fitness <- df_fitness %>%
  mutate(day = format(df_fitness$ActivityDate, "%A"))

```


- Create a new dataframe that hold sum_activity and grouped by Id and month 

```{r}
monthly_data <- df_fitness %>%
  group_by( Id,month)%>%
  summarise(sum_activity = sum(VeryActiveMinutes, FairlyActiveMinutes,LightlyActiveMinutes,SedentaryMinutes), calories =sum(Calories))
```

# let's see the if the month have an influnce on users?

```{r}
plot1 <- ggplot(monthly_data, aes(x = month,fill = month)) +
  geom_density(alpha = 0.7) +
  theme(legend.position = c(0.8, 0.8))

plot2 <- ggplot(monthly_data, aes(month,sum_activity, color=month))+geom_jitter()

plot3 <- ggplot(monthly_data, aes(month,calories, color=month))+geom_jitter()

cowplot::plot_grid(plot1, plot2,plot3,  labels = "AUTO")

```

# let's see the if the day have an influnce on users activity?
```{r}

df_fitness <- df_fitness %>%
  mutate(sum_activity = sum(VeryActiveMinutes,FairlyActiveMinutes,LightlyActiveMinutes,SedentaryMinutes))

mean <- mean(df_fitness$TotalSteps)
totalstep_per_days <- ggplot(df_fitness, aes(day,mean))+geom_col(fill="#B1D4E0")+theme(axis.text.x = element_text(angle = 45, hjust=1))
sumactivity_per_days <- ggplot(df_fitness, aes(day,sum_activity))+geom_col(fill="#2E8BC0")+theme(axis.text.x = element_text(angle = 45, hjust=1))

cowplot::plot_grid(totalstep_per_days, sumactivity_per_days,  labels = "AUTO")

```
- From the graph we can see that weekend have drop in total steps and sum activity, which means that weekdays have an affect on the users activity level

# other question could be raised here is there a prefered hours to exersice?
# useing Hourly Intensities dataset: 
```{r}
df_Intensities <- read.csv(file = '~/Documents/Misk_DSI_data/private/hourlyIntensities_merged.csv')
str(df_Intensities)
```
```{r}

df_Intensities$ActivityHour <- strptime(df_Intensities$ActivityHour,format="%m/%d/%Y %H:%M:%S")

df_Intensities$Time <- format(as.POSIXct(df_Intensities$ActivityHour,format="%Y:%m:%d %H:%M:%S"),"%H:%M:%S")

df_Intensities$Date <- as.Date(df_Intensities$ActivityHour, format = "%m:%d:%Y")

#df_Intensities$Time <- as.POSIXct(x = df_Intensities$ActivityHour, format = "%H:%M:%S") 

str(df_Intensities)
```


```{r}
ggplot(df_Intensities) + 
geom_bar(stat = "identity", aes(x = Time, y = TotalIntensity  , fill = TotalIntensity  )) +
labs(title = "Hourly Steps in a 24 hour period") +
scale_fill_gradient(low = "white", high = "blue") + 
theme(axis.text.x = element_text(angle = 90))
```

- From the plot it show that users tend to be more active in the hours range 5-7 much more early moring and in the evening 

#Q2:How much active the users using fitbit tracker? 

#Categrize users to activity levels based on total steps during two month? 

- create a new dataframe having ID and Total_steps_mean and activity level
```{r}
User_activity_level <- df_fitness %>%
  group_by(Id) %>%
  summarise(Total_steps_mean=mean(TotalSteps))
```


```{r}
library(dplyr)
User_activity_level <- User_activity_level %>%
  mutate(activity_level = case_when(
    Total_steps_mean < 2000 ~ "sedentary",
    Total_steps_mean >= 2000 & Total_steps_mean < 7500 ~ "low active", 
    Total_steps_mean >= 7500 & Total_steps_mean < 10000 ~ "somewhat active", 
    Total_steps_mean >= 10000 & Total_steps_mean < 12500 ~ "active",
    Total_steps_mean >= 12500 ~ "highly active",
  ))
```

# visualize the different user activity category
```{r}

library(plotly)
vis <- plot_ly(User_activity_level, x = ~Total_steps_mean, color = ~activity_level, type = "bar")
vis

```


#Q3: Is there any improvement in the users weight or average caleroies per day? 
# using weight lig info dataset 
```{r}
df_weight <- read.csv(file = '~/Documents/Misk_DSI_data/private/weightLogInfo_merged.csv')
```


```{r}
df_weight = subset(df_weight, select = -c(WeightPounds, Fat, LogId))
str(df_weight)
```

```{r}
df_weight <- df_weight %>%
   mutate(Date=as.Date(Date, format = "%m/%d/%Y")) 

str(df_weight)
```

```{r}
df_weight <- df_weight %>%
  mutate(month = format(df_weight$Date, "%m"))

weight_monthly_data <- df_weight %>%
  group_by(month, Id)%>%
  summarise(Weight_mean= mean(WeightKg))
```

## users mean Weight between two month 
```{r}
length(unique(df_weight$Id))

plot_w1 <- ggplot(weight_monthly_data, aes(x = Id, y = Weight_mean, fill=month)) + 
  geom_col(position= "dodge") + 
  labs(title = "Average Weight per user Id During Two Months", x = "Users")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  scale_x_continuous("Id", labels = as.character(weight_monthly_data$Id), breaks = weight_monthly_data$Id)
```

## users mean calories between two month 

You can also embed plots, for example:

```{r pressure, echo=FALSE}
vis <- plot_ly(monthly_data, x = ~calories, color = ~month, type = "bar")
vis

```
